input {
    beats {
        port => "5044" 
    }
}
filter {
    grok {
            match => { "message" => "\[(?<timestamp>\d{,4}-?\d{,4}-?\d{,4}[T]?\d{,4}:?\d{,4}:?\d{,4}[.,]?\d{,4})\] \[%{WORD:loglevel}\] %{WORD:proc} - %{GREEDYDATA:tail}"}     
        }
    if [tail] =~ /^([Ss]tart|[Ff]inish)\s(esb call for operation).*$/ {
        grok {
            match => { "tail" => "%{WORD:action} (esb call for operation=)%{WORD:esb-method}. %{WORD:event-type} (=> ) %{GREEDYDATA:event-payload}"}     
        }
    }
    if [tail] =~ /.*(GET \/package\.json HTTP).*(kube-probe).*/{
        drop {}
    }
}

output {
    elasticsearch {
        hosts => [ "http://elasticsearch:9200" ]
    }
}